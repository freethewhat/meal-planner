import{s as re,d as U,e as ie,o as ce,c as _,f as t,g as p,w as a,h as d,u as f,b as o,a as u,i as y,F as k,r as w,t as c,j as B,k as me,m as ve,l as _e}from"./index-jdeqBAM5.js";import{u as pe,s as $,e as T,f as S}from"./meals-DFlJInB-.js";import{e as fe}from"./eachDayOfInterval-CZxSti0q.js";const ye={class:"space-y-6"},ke={class:"d-flex align-center justify-space-between"},ge={class:"d-flex gap-4"},Ve={key:0,class:"d-flex justify-center"},xe={class:"d-flex justify-space-between align-start"},Me={class:"text-h6"},be={class:"text-caption"},we={class:"text-caption mt-2"},Ce={class:"mt-2"},Ee={class:"d-flex justify-space-between mt-4"},Ue={class:"text-caption"},Se={class:"text-caption"},he={class:"text-h4"},Ne={class:"text-caption mt-1"},De={class:"pl-4"},Oe={class:"text-caption"},qe={class:"text-h6"},Be={__name:"WeeklyView",setup(Ie){const C=pe(),{weeklyMeals:P,loading:F,error:O,currentWeekStart:q}=re(C),h=U(!1),v=U(null),M=U(!1),n=U(null),I=U(!1),D=U(!1),J=ie(()=>{const s=$(q.value,{weekStartsOn:1}),e=T(q.value,{weekStartsOn:1});return fe({start:s,end:e}).map(r=>S(r,"yyyy-MM-dd"))}),K=s=>{const e=new Date,r=$(e,{weekStartsOn:1}),g=T(e,{weekStartsOn:1}),b=new Date(s);return b>=r&&b<=g},N=s=>{if(s instanceof Date)return s;const[e,r,g]=s.split("-").map(Number);return new Date(e,r-1,g,12,0,0)},L=async s=>{var r;console.log("Opening modal with meal date:",s.date),v.value=s,h.value=!0,M.value=!1;const{data:{session:e}}=await _e.auth.getSession();I.value=((r=e==null?void 0:e.user)==null?void 0:r.email)==="matthew.c.sutton@gmail.com"},R=()=>{h.value=!1,v.value=null,M.value=!1,n.value=null},Z=()=>{console.log("Starting edit with date:",v.value.date),n.value=JSON.parse(JSON.stringify(v.value)),n.value.date=v.value.date,console.log("Editing meal date set to:",n.value.date),M.value=!0},z=()=>{M.value=!1,n.value=null},G=()=>{n.value.ingredients||(n.value.ingredients=[]),n.value.ingredients.push({name:"",amount:"",unit:""})},H=s=>{n.value.ingredients.splice(s,1)},W=async()=>{try{console.log("Before save - editingMeal date:",n.value.date);const s={...n.value,date:n.value.date};console.log("About to save meal with date:",s.date),await C.updateMeal(s.id,s),console.log("After save - selectedMeal date:",v.value.date),v.value=s,M.value=!1,n.value=null}catch(s){console.error("Error saving meal:",s)}},j=s=>s.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase());return ce(()=>{C.fetchMeals()}),(s,e)=>{const r=d("v-btn"),g=d("v-card-text"),b=d("v-card"),Q=d("v-progress-circular"),X=d("v-alert"),i=d("v-col"),E=d("v-row"),Y=d("v-card-title"),ee=d("v-list-item"),te=d("v-list"),le=d("v-divider"),V=d("v-text-field"),ae=d("v-date-picker"),ne=d("v-menu"),A=d("v-textarea"),oe=d("v-form"),se=d("v-spacer"),ue=d("v-card-actions"),de=d("v-dialog");return o(),_("div",ye,[t(b,null,{default:a(()=>[t(g,null,{default:a(()=>[u("div",ke,[t(r,{onClick:f(C).previousWeek,variant:"outlined"},{default:a(()=>e[9]||(e[9]=[y(" Previous ")])),_:1,__:[9]},8,["onClick"]),u("div",ge,[(o(!0),_(k,null,w(J.value,l=>(o(),p(r,{key:l,onClick:m=>f(C).setCurrentWeek(l),color:K(l)?"primary":void 0,variant:"text"},{default:a(()=>[y(c(f(S)(N(l),"EEE")),1)]),_:2},1032,["onClick","color"]))),128))]),t(r,{onClick:f(C).nextWeek,variant:"outlined"},{default:a(()=>e[10]||(e[10]=[y(" Next ")])),_:1,__:[10]},8,["onClick"])])]),_:1})]),_:1}),f(F)?(o(),_("div",Ve,[t(Q,{indeterminate:"",color:"primary"})])):f(O)?(o(),p(X,{key:1,type:"error"},{default:a(()=>[y(c(f(O)),1)]),_:1})):(o(),p(E,{key:2},{default:a(()=>[(o(!0),_(k,null,w(f(P),l=>(o(),p(i,{key:l.id,cols:"12",md:"6",lg:"4"},{default:a(()=>[t(b,{class:"h-100",onClick:m=>L(l),hover:""},{default:a(()=>[t(g,null,{default:a(()=>[u("div",xe,[u("h3",Me,c(l.name),1),u("span",be,c(f(S)(N(l.date),"EEE, MMM d")),1)]),u("p",we,c(l.time),1),u("p",Ce,c(l.description),1),u("div",Ee,[u("div",Ue,c(l.servings)+" servings ",1),u("div",Se,c(l.nutrition.per_serving.calories)+" cal/serving ",1)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),t(de,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l),"max-width":"800"},{default:a(()=>[v.value?(o(),p(b,{key:0},{default:a(()=>[t(Y,{class:"d-flex justify-space-between align-center"},{default:a(()=>[u("div",null,[u("span",he,c(v.value.name),1),u("div",Ne,c(f(S)(N(v.value.date),"EEEE, MMMM d, yyyy")),1)]),I.value?(o(),p(r,{key:0,icon:"mdi-pencil",variant:"text",onClick:Z})):B("",!0)]),_:1}),t(g,null,{default:a(()=>[M.value?(o(),p(oe,{key:1,onSubmit:me(W,["prevent"])},{default:a(()=>[t(E,null,{default:a(()=>[t(i,{cols:"12"},{default:a(()=>[t(V,{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value.name=l),label:"Meal Name",required:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(V,{modelValue:n.value.time,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value.time=l),label:"Preparation Time",required:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(ne,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=l=>D.value=l),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:a(({props:l})=>[t(V,ve({"model-value":f(S)(N(n.value.date),"EEEE, MMMM d, yyyy"),label:"Date","prepend-icon":"mdi-calendar",readonly:""},l,{required:""}),null,16,["model-value"])]),default:a(()=>[t(ae,{modelValue:n.value.date,"onUpdate:modelValue":[e[2]||(e[2]=l=>n.value.date=l),e[3]||(e[3]=l=>D.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(i,{cols:"12",md:"6"},{default:a(()=>[t(V,{modelValue:n.value.servings,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.servings=l),modelModifiers:{number:!0},label:"Servings",type:"number",required:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[t(A,{modelValue:n.value.description,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.description=l),label:"Description",required:""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[e[15]||(e[15]=u("h4",{class:"text-h6 mb-4"},"Ingredients",-1)),(o(!0),_(k,null,w(n.value.ingredients,(l,m)=>(o(),p(E,{key:m},{default:a(()=>[t(i,{cols:"12",md:"4"},{default:a(()=>[t(V,{modelValue:l.name,"onUpdate:modelValue":x=>l.name=x,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(i,{cols:"12",md:"3"},{default:a(()=>[t(V,{modelValue:l.amount,"onUpdate:modelValue":x=>l.amount=x,label:"Amount",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(i,{cols:"12",md:"3"},{default:a(()=>[t(V,{modelValue:l.unit,"onUpdate:modelValue":x=>l.unit=x,label:"Unit",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(i,{cols:"12",md:"2",class:"d-flex align-center"},{default:a(()=>[t(r,{icon:"mdi-delete",color:"error",variant:"text",onClick:x=>H(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(r,{color:"primary",variant:"text",onClick:G,class:"mt-2"},{default:a(()=>e[14]||(e[14]=[y(" Add Ingredient ")])),_:1,__:[14]})]),_:1,__:[15]}),t(i,{cols:"12"},{default:a(()=>[t(A,{modelValue:n.value.instructions,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.instructions=l),label:"Instructions",required:"",hint:"Enter each step on a new line","persistent-hint":""},null,8,["modelValue"])]),_:1}),t(i,{cols:"12"},{default:a(()=>[e[16]||(e[16]=u("h4",{class:"text-h6 mb-4"},"Nutrition Information",-1)),t(E,null,{default:a(()=>[(o(!0),_(k,null,w(n.value.nutrition.per_serving,(l,m)=>(o(),p(i,{key:m,cols:"6",md:"3"},{default:a(()=>[t(V,{modelValue:n.value.nutrition.per_serving[m],"onUpdate:modelValue":x=>n.value.nutrition.per_serving[m]=x,modelModifiers:{number:!0},label:j(m),type:"number",required:""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})]),_:1,__:[16]})]),_:1})]),_:1})):(o(),_(k,{key:0},[t(E,null,{default:a(()=>[t(i,{cols:"12",md:"6"},{default:a(()=>[e[11]||(e[11]=u("h4",{class:"text-h6 mb-4"},"Ingredients",-1)),t(te,null,{default:a(()=>[(o(!0),_(k,null,w(v.value.ingredients,l=>(o(),p(ee,{key:l.name},{default:a(()=>[y(c(l.amount)+" "+c(l.unit)+" "+c(l.name),1)]),_:2},1024))),128))]),_:1})]),_:1,__:[11]}),t(i,{cols:"12",md:"6"},{default:a(()=>[e[12]||(e[12]=u("h4",{class:"text-h6 mb-4"},"Instructions",-1)),u("ol",De,[(o(!0),_(k,null,w(v.value.instructions.split(`
`),(l,m)=>(o(),_("li",{key:m,class:"mb-2"},c(l),1))),128))])]),_:1,__:[12]})]),_:1}),t(le,{class:"my-4"}),e[13]||(e[13]=u("h4",{class:"text-h6 mb-4"},"Nutrition Information",-1)),t(E,null,{default:a(()=>[(o(!0),_(k,null,w(v.value.nutrition.per_serving,(l,m)=>(o(),p(i,{key:m,cols:"6",md:"3"},{default:a(()=>[t(b,{variant:"outlined"},{default:a(()=>[t(g,null,{default:a(()=>[u("div",Oe,c(j(m)),1),u("div",qe,c(l),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))]),_:1}),t(ue,null,{default:a(()=>[t(se),M.value?(o(),_(k,{key:0},[t(r,{color:"error",variant:"text",onClick:z},{default:a(()=>e[17]||(e[17]=[y(" Cancel ")])),_:1,__:[17]}),t(r,{color:"primary",onClick:W},{default:a(()=>e[18]||(e[18]=[y(" Save Changes ")])),_:1,__:[18]})],64)):(o(),p(r,{key:1,color:"primary",onClick:R},{default:a(()=>e[19]||(e[19]=[y(" Close ")])),_:1,__:[19]}))]),_:1})]),_:1})):B("",!0)]),_:1},8,["modelValue"])])}}};export{Be as default};
