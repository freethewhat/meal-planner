import{d as a,e as y,b as s,w as t,f as e,a as u,t as f,u as w,c as x,F as U,r as N,g as C,s as ue,h as E,i as I,o as de,j as z,k as ce,m as me,l as ve}from"./index-DS60vfBK.js";import{f as D,u as _e,s as F,e as fe}from"./meals-DrHNgWSt.js";import{e as pe}from"./eachDayOfInterval-BGLJiQ62.js";const ye={class:"d-flex justify-space-between align-start"},ge={class:"text-h6 text-truncate"},xe={class:"text-caption"},ke={class:"text-caption mt-2"},be={class:"mt-2 text-body-2"},Ve={class:"d-flex justify-space-between mt-4"},Me={class:"text-caption"},we={class:"text-caption"},Ce={__name:"MealCard",props:{meal:{type:Object,required:!0}},emits:["click"],setup(c){const v=r=>{if(r instanceof Date)return r;const[o,p,_]=r.split("-");return new Date(Date.UTC(o,p-1,_,12,0,0))};return(r,o)=>{const p=a("v-card-text"),_=a("v-card");return s(),y(_,{class:"h-100",onClick:o[0]||(o[0]=g=>r.$emit("click")),hover:""},{default:t(()=>[e(p,null,{default:t(()=>[u("div",ye,[u("h3",ge,f(c.meal.name),1),u("span",xe,f(w(D)(v(c.meal.date),"EEE, MMM d")),1)]),u("p",ke,f(c.meal.time),1),u("p",be,f(c.meal.description),1),u("div",Ve,[u("div",Me,f(c.meal.servings)+" servings ",1),u("div",we,f(c.meal.nutrition.per_serving.calories)+" cal/serving ",1)])]),_:1})]),_:1})}}},$e={class:"text-caption"},De={class:"text-h6"},J={__name:"NutritionInfo",props:{nutrition:{type:Object,required:!0},editable:{type:Boolean,default:!1}},setup(c){const v=r=>r.split("_").map(o=>o.charAt(0).toUpperCase()+o.slice(1)).join(" ");return(r,o)=>{const p=a("v-card-text"),_=a("v-card"),g=a("v-text-field"),d=a("v-col"),b=a("v-row");return s(),x("div",null,[o[0]||(o[0]=u("h4",{class:"text-h6 mb-4"},"Nutrition Information",-1)),e(b,null,{default:t(()=>[(s(!0),x(U,null,N(c.nutrition.per_serving,(l,V)=>(s(),y(d,{key:V,cols:"6",sm:"4",md:"3"},{default:t(()=>[c.editable?(s(),y(g,{key:1,modelValue:c.nutrition.per_serving[V],"onUpdate:modelValue":k=>c.nutrition.per_serving[V]=k,label:v(V),type:"number",required:""},null,8,["modelValue","onUpdate:modelValue","label"])):(s(),y(_,{key:0,variant:"outlined"},{default:t(()=>[e(p,null,{default:t(()=>[u("div",$e,f(v(V)),1),u("div",De,f(l),1)]),_:2},1024)]),_:2},1024))]),_:2},1024))),128))]),_:1})])}}},L={__name:"IngredientList",props:{ingredients:{type:Array,required:!0},editable:{type:Boolean,default:!1}},emits:["add","remove"],setup(c){return(v,r)=>{const o=a("v-list-item"),p=a("v-list"),_=a("v-text-field"),g=a("v-col"),d=a("v-btn"),b=a("v-row");return s(),x("div",null,[r[2]||(r[2]=u("h4",{class:"text-h6 mb-4"},"Ingredients",-1)),c.editable?(s(),x(U,{key:1},[(s(!0),x(U,null,N(c.ingredients,(l,V)=>(s(),y(b,{key:V},{default:t(()=>[e(g,{cols:"12",sm:"4"},{default:t(()=>[e(_,{modelValue:l.name,"onUpdate:modelValue":k=>l.name=k,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{cols:"12",sm:"3"},{default:t(()=>[e(_,{modelValue:l.amount,"onUpdate:modelValue":k=>l.amount=k,label:"Amount",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{cols:"12",sm:"3"},{default:t(()=>[e(_,{modelValue:l.unit,"onUpdate:modelValue":k=>l.unit=k,label:"Unit",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(g,{cols:"12",sm:"2",class:"d-flex align-center"},{default:t(()=>[e(d,{icon:"mdi-delete",color:"error",variant:"text",onClick:k=>v.$emit("remove",V)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),e(d,{color:"primary",variant:"text",onClick:r[0]||(r[0]=l=>v.$emit("add")),class:"mt-2"},{default:t(()=>r[1]||(r[1]=[C(" Add Ingredient ")])),_:1,__:[1]})],64)):(s(),y(p,{key:0},{default:t(()=>[(s(!0),x(U,null,N(c.ingredients,l=>(s(),y(o,{key:l.name},{default:t(()=>[C(f(l.amount)+" "+f(l.unit)+" "+f(l.name),1)]),_:2},1024))),128))]),_:1}))])}}},Ue={class:"d-flex flex-column flex-sm-row align-center justify-space-between gap-4"},Ee={class:"d-flex align-center gap-2"},Se={class:"d-flex flex-column flex-sm-row align-center gap-2"},Ne={class:"text-subtitle-1 text-sm-h6 text-center"},qe={__name:"WeekNavigation",props:{startDate:{type:String,required:!0},endDate:{type:String,required:!0},isCurrentWeek:{type:Boolean,default:!1}},emits:["previous","next","current"],setup(c){const v=r=>{if(r instanceof Date)return r;const[o,p,_]=r.split("-");return new Date(Date.UTC(o,p-1,_,12,0,0))};return(r,o)=>{const p=a("v-btn"),_=a("v-card-text"),g=a("v-card");return s(),y(g,null,{default:t(()=>[e(_,null,{default:t(()=>[u("div",Ue,[u("div",Ee,[e(p,{onClick:o[0]||(o[0]=d=>r.$emit("previous")),variant:"outlined",size:"small"},{default:t(()=>o[3]||(o[3]=[C(" Previous ")])),_:1,__:[3]}),e(p,{onClick:o[1]||(o[1]=d=>r.$emit("next")),variant:"outlined",size:"small"},{default:t(()=>o[4]||(o[4]=[C(" Next ")])),_:1,__:[4]})]),u("div",Se,[e(p,{onClick:o[2]||(o[2]=d=>r.$emit("current")),variant:"text",color:c.isCurrentWeek?"primary":void 0,size:"small"},{default:t(()=>o[5]||(o[5]=[C(" This Week ")])),_:1,__:[5]},8,["color"]),u("div",Ne,f(w(D)(v(c.startDate),"MMM d"))+" - "+f(w(D)(v(c.endDate),"MMM d, yyyy")),1)])])]),_:1})]),_:1})}}},he={class:"space-y-4"},We={key:0,class:"d-flex justify-center"},Oe={class:"text-h4 text-truncate"},je={class:"text-caption mt-1"},Ae={class:"d-flex align-center gap-2"},Be={class:"pl-4"},ze={__name:"WeeklyView",setup(c){const v=_e(),{weeklyMeals:r,loading:o,error:p,currentWeekStart:_}=ue(v),g=E(!1),d=E(null),b=E(!1),l=E(null),V=E(!1),k=E(!1),O=I(()=>{const m=F(_.value,{weekStartsOn:1}),n=fe(_.value,{weekStartsOn:1});return pe({start:m,end:n}).map($=>D($,"yyyy-MM-dd"))}),j=m=>{if(m instanceof Date)return m;const[n,$,h]=m.split("-").map(Number);return new Date(n,$-1,h,12,0,0)},R=async m=>{var $;console.log("Opening modal with meal date:",m.date),d.value=m,g.value=!0,b.value=!1;const{data:{session:n}}=await ve.auth.getSession();V.value=(($=n==null?void 0:n.user)==null?void 0:$.email)==="matthew.c.sutton@gmail.com"},A=()=>{g.value=!1,d.value=null,b.value=!1,l.value=null},K=()=>{console.log("Starting edit with date:",d.value.date),l.value=JSON.parse(JSON.stringify(d.value)),l.value.date=d.value.date,console.log("Editing meal date set to:",l.value.date),b.value=!0},G=()=>{b.value=!1,l.value=null},H=()=>{l.value.ingredients||(l.value.ingredients=[]),l.value.ingredients.push({name:"",amount:"",unit:""})},Q=m=>{l.value.ingredients.splice(m,1)},B=async()=>{try{console.log("Before save - editingMeal date:",l.value.date);const m={...l.value,date:l.value.date};console.log("About to save meal with date:",m.date),await v.updateMeal(m.id,m),console.log("After save - selectedMeal date:",d.value.date),d.value=m,b.value=!1,l.value=null}catch(m){console.error("Error saving meal:",m)}},X=I(()=>{const n=F(new Date,{weekStartsOn:1});return D(n,"yyyy-MM-dd")===D(_.value,"yyyy-MM-dd")}),Y=()=>{v.setCurrentWeek(new Date)};return de(()=>{v.fetchMeals()}),(m,n)=>{const $=a("v-progress-circular"),h=a("v-alert"),M=a("v-col"),W=a("v-row"),S=a("v-btn"),Z=a("v-card-title"),ee=a("v-divider"),q=a("v-text-field"),te=a("v-date-picker"),le=a("v-menu"),T=a("v-textarea"),ne=a("v-form"),ae=a("v-card-text"),oe=a("v-spacer"),se=a("v-card-actions"),re=a("v-card"),ie=a("v-dialog");return s(),x("div",he,[e(qe,{"start-date":O.value[0],"end-date":O.value[6],"is-current-week":X.value,onPrevious:w(v).previousWeek,onNext:w(v).nextWeek,onCurrent:Y},null,8,["start-date","end-date","is-current-week","onPrevious","onNext"]),w(o)?(s(),x("div",We,[e($,{indeterminate:"",color:"primary"})])):w(p)?(s(),y(h,{key:1,type:"error"},{default:t(()=>[C(f(w(p)),1)]),_:1})):(s(),y(W,{key:2},{default:t(()=>[(s(!0),x(U,null,N(w(r),i=>(s(),y(M,{key:i.id,cols:"12",sm:"6",md:"4"},{default:t(()=>[e(Ce,{meal:i,onClick:P=>R(i)},null,8,["meal","onClick"])]),_:2},1024))),128))]),_:1})),e(ie,{modelValue:g.value,"onUpdate:modelValue":n[8]||(n[8]=i=>g.value=i),"max-width":"800",fullscreen:"smAndDown"},{default:t(()=>[d.value?(s(),y(re,{key:0},{default:t(()=>[e(Z,{class:"d-flex flex-column flex-sm-row justify-space-between align-start gap-2"},{default:t(()=>[u("div",null,[u("span",Oe,f(d.value.name),1),u("div",je,f(w(D)(j(d.value.date),"EEEE, MMMM d, yyyy")),1)]),u("div",Ae,[V.value?(s(),y(S,{key:0,icon:"mdi-pencil",variant:"text",onClick:K})):z("",!0),e(S,{icon:"mdi-close",variant:"text",onClick:A})])]),_:1}),e(ae,null,{default:t(()=>[b.value?(s(),y(ne,{key:1,onSubmit:ce(B,["prevent"])},{default:t(()=>[e(W,null,{default:t(()=>[e(M,{cols:"12"},{default:t(()=>[e(q,{modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=i=>l.value.name=i),label:"Meal Name",required:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",sm:"6"},{default:t(()=>[e(q,{modelValue:l.value.time,"onUpdate:modelValue":n[1]||(n[1]=i=>l.value.time=i),label:"Preparation Time",required:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12",sm:"6"},{default:t(()=>[e(le,{modelValue:k.value,"onUpdate:modelValue":n[4]||(n[4]=i=>k.value=i),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:t(({props:i})=>[e(q,me({"model-value":w(D)(j(l.value.date),"EEEE, MMMM d, yyyy"),label:"Date","prepend-icon":"mdi-calendar",readonly:""},i,{required:""}),null,16,["model-value"])]),default:t(()=>[e(te,{modelValue:l.value.date,"onUpdate:modelValue":[n[2]||(n[2]=i=>l.value.date=i),n[3]||(n[3]=i=>k.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e(M,{cols:"12",sm:"6"},{default:t(()=>[e(q,{modelValue:l.value.servings,"onUpdate:modelValue":n[5]||(n[5]=i=>l.value.servings=i),modelModifiers:{number:!0},label:"Servings",type:"number",required:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(T,{modelValue:l.value.description,"onUpdate:modelValue":n[6]||(n[6]=i=>l.value.description=i),label:"Description",required:""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(L,{ingredients:l.value.ingredients,editable:!0,onAdd:H,onRemove:Q},null,8,["ingredients"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(T,{modelValue:l.value.instructions,"onUpdate:modelValue":n[7]||(n[7]=i=>l.value.instructions=i),label:"Instructions",required:"",hint:"Enter each step on a new line","persistent-hint":""},null,8,["modelValue"])]),_:1}),e(M,{cols:"12"},{default:t(()=>[e(J,{nutrition:l.value.nutrition,editable:!0},null,8,["nutrition"])]),_:1})]),_:1})]),_:1})):(s(),x(U,{key:0},[e(W,null,{default:t(()=>[e(M,{cols:"12",md:"6"},{default:t(()=>[e(L,{ingredients:d.value.ingredients,editable:!1},null,8,["ingredients"])]),_:1}),e(M,{cols:"12",md:"6"},{default:t(()=>[n[9]||(n[9]=u("h4",{class:"text-h6 mb-4"},"Instructions",-1)),u("ol",Be,[(s(!0),x(U,null,N(d.value.instructions.split(`
`),(i,P)=>(s(),x("li",{key:P,class:"mb-2"},f(i),1))),128))])]),_:1,__:[9]})]),_:1}),e(ee,{class:"my-4"}),e(J,{nutrition:d.value.nutrition,editable:!1},null,8,["nutrition"])],64))]),_:1}),e(se,null,{default:t(()=>[e(oe),b.value?(s(),x(U,{key:0},[e(S,{color:"error",variant:"text",onClick:G},{default:t(()=>n[10]||(n[10]=[C(" Cancel ")])),_:1,__:[10]}),e(S,{color:"primary",onClick:B},{default:t(()=>n[11]||(n[11]=[C(" Save Changes ")])),_:1,__:[11]})],64)):(s(),y(S,{key:1,color:"primary",onClick:A},{default:t(()=>n[12]||(n[12]=[C(" Close ")])),_:1,__:[12]}))]),_:1})]),_:1})):z("",!0)]),_:1},8,["modelValue"])])}}};export{ze as default};
