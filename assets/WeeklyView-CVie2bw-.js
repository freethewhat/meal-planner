import{s as ie,d as E,e as B,o as ce,c as _,f as t,g as p,w as l,h as d,u as f,b as o,a as s,i as y,t as i,F as V,r as U,j as $,k as ve,m as me,l as _e}from"./index-qYHC1KkS.js";import{u as pe,s as P,e as fe,f as M}from"./meals-CmbKNI5e.js";import{e as ye}from"./eachDayOfInterval-U_RYVfhK.js";const ge={class:"space-y-6"},ke={class:"d-flex align-center justify-space-between"},Ve={class:"d-flex align-center gap-4"},Me={class:"text-h6"},xe={key:0,class:"d-flex justify-center"},be={class:"d-flex justify-space-between align-start"},we={class:"text-h6"},Ce={class:"text-caption"},Ee={class:"text-caption mt-2"},Ue={class:"mt-2"},Se={class:"d-flex justify-space-between mt-4"},he={class:"text-caption"},Ne={class:"text-caption"},qe={class:"text-h4"},De={class:"text-caption mt-1"},Oe={class:"pl-4"},We={class:"text-caption"},Ie={class:"text-h6"},$e={__name:"WeeklyView",setup(je){const b=pe(),{weeklyMeals:F,loading:J,error:O,currentWeekStart:q}=ie(b),h=E(!1),v=E(null),x=E(!1),n=E(null),W=E(!1),D=E(!1),I=B(()=>{const u=P(q.value,{weekStartsOn:1}),e=fe(q.value,{weekStartsOn:1});return ye({start:u,end:e}).map(c=>M(c,"yyyy-MM-dd"))}),S=u=>{if(u instanceof Date)return u;const[e,c,w]=u.split("-").map(Number);return new Date(e,c-1,w,12,0,0)},K=async u=>{var c;console.log("Opening modal with meal date:",u.date),v.value=u,h.value=!0,x.value=!1;const{data:{session:e}}=await _e.auth.getSession();W.value=((c=e==null?void 0:e.user)==null?void 0:c.email)==="matthew.c.sutton@gmail.com"},L=()=>{h.value=!1,v.value=null,x.value=!1,n.value=null},R=()=>{console.log("Starting edit with date:",v.value.date),n.value=JSON.parse(JSON.stringify(v.value)),n.value.date=v.value.date,console.log("Editing meal date set to:",n.value.date),x.value=!0},Z=()=>{x.value=!1,n.value=null},z=()=>{n.value.ingredients||(n.value.ingredients=[]),n.value.ingredients.push({name:"",amount:"",unit:""})},G=u=>{n.value.ingredients.splice(u,1)},j=async()=>{try{console.log("Before save - editingMeal date:",n.value.date);const u={...n.value,date:n.value.date};console.log("About to save meal with date:",u.date),await b.updateMeal(u.id,u),console.log("After save - selectedMeal date:",v.value.date),v.value=u,x.value=!1,n.value=null}catch(u){console.error("Error saving meal:",u)}},A=u=>u.replace(/_/g," ").replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()),H=B(()=>{const e=P(new Date,{weekStartsOn:1});return M(e,"yyyy-MM-dd")===M(q.value,"yyyy-MM-dd")}),Q=()=>{b.setCurrentWeek(new Date)};return ce(()=>{b.fetchMeals()}),(u,e)=>{const c=d("v-btn"),w=d("v-card-text"),N=d("v-card"),X=d("v-progress-circular"),Y=d("v-alert"),r=d("v-col"),C=d("v-row"),ee=d("v-card-title"),te=d("v-list-item"),le=d("v-list"),ae=d("v-divider"),g=d("v-text-field"),ne=d("v-date-picker"),oe=d("v-menu"),T=d("v-textarea"),se=d("v-form"),ue=d("v-spacer"),de=d("v-card-actions"),re=d("v-dialog");return o(),_("div",ge,[t(N,null,{default:l(()=>[t(w,null,{default:l(()=>[s("div",ke,[t(c,{onClick:f(b).previousWeek,variant:"outlined"},{default:l(()=>e[9]||(e[9]=[y(" Previous ")])),_:1,__:[9]},8,["onClick"]),s("div",Ve,[t(c,{onClick:Q,variant:"text",color:H.value?"primary":void 0},{default:l(()=>e[10]||(e[10]=[y(" This Week ")])),_:1,__:[10]},8,["color"]),s("div",Me,i(f(M)(S(I.value[0]),"MMM d"))+" - "+i(f(M)(S(I.value[6]),"MMM d, yyyy")),1)]),t(c,{onClick:f(b).nextWeek,variant:"outlined"},{default:l(()=>e[11]||(e[11]=[y(" Next ")])),_:1,__:[11]},8,["onClick"])])]),_:1})]),_:1}),f(J)?(o(),_("div",xe,[t(X,{indeterminate:"",color:"primary"})])):f(O)?(o(),p(Y,{key:1,type:"error"},{default:l(()=>[y(i(f(O)),1)]),_:1})):(o(),p(C,{key:2},{default:l(()=>[(o(!0),_(V,null,U(f(F),a=>(o(),p(r,{key:a.id,cols:"12",md:"6",lg:"4"},{default:l(()=>[t(N,{class:"h-100",onClick:m=>K(a),hover:""},{default:l(()=>[t(w,null,{default:l(()=>[s("div",be,[s("h3",we,i(a.name),1),s("span",Ce,i(f(M)(S(a.date),"EEE, MMM d")),1)]),s("p",Ee,i(a.time),1),s("p",Ue,i(a.description),1),s("div",Se,[s("div",he,i(a.servings)+" servings ",1),s("div",Ne,i(a.nutrition.per_serving.calories)+" cal/serving ",1)])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})),t(re,{modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=a=>h.value=a),"max-width":"800"},{default:l(()=>[v.value?(o(),p(N,{key:0},{default:l(()=>[t(ee,{class:"d-flex justify-space-between align-center"},{default:l(()=>[s("div",null,[s("span",qe,i(v.value.name),1),s("div",De,i(f(M)(S(v.value.date),"EEEE, MMMM d, yyyy")),1)]),W.value?(o(),p(c,{key:0,icon:"mdi-pencil",variant:"text",onClick:R})):$("",!0)]),_:1}),t(w,null,{default:l(()=>[x.value?(o(),p(se,{key:1,onSubmit:ve(j,["prevent"])},{default:l(()=>[t(C,null,{default:l(()=>[t(r,{cols:"12"},{default:l(()=>[t(g,{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value.name=a),label:"Meal Name",required:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",md:"6"},{default:l(()=>[t(g,{modelValue:n.value.time,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value.time=a),label:"Preparation Time",required:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12",md:"6"},{default:l(()=>[t(oe,{modelValue:D.value,"onUpdate:modelValue":e[4]||(e[4]=a=>D.value=a),"close-on-content-click":!1,transition:"scale-transition","min-width":"auto"},{activator:l(({props:a})=>[t(g,me({"model-value":f(M)(S(n.value.date),"EEEE, MMMM d, yyyy"),label:"Date","prepend-icon":"mdi-calendar",readonly:""},a,{required:""}),null,16,["model-value"])]),default:l(()=>[t(ne,{modelValue:n.value.date,"onUpdate:modelValue":[e[2]||(e[2]=a=>n.value.date=a),e[3]||(e[3]=a=>D.value=!1)]},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),t(r,{cols:"12",md:"6"},{default:l(()=>[t(g,{modelValue:n.value.servings,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.servings=a),modelModifiers:{number:!0},label:"Servings",type:"number",required:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12"},{default:l(()=>[t(T,{modelValue:n.value.description,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.description=a),label:"Description",required:""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12"},{default:l(()=>[e[16]||(e[16]=s("h4",{class:"text-h6 mb-4"},"Ingredients",-1)),(o(!0),_(V,null,U(n.value.ingredients,(a,m)=>(o(),p(C,{key:m},{default:l(()=>[t(r,{cols:"12",md:"4"},{default:l(()=>[t(g,{modelValue:a.name,"onUpdate:modelValue":k=>a.name=k,label:"Name",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{cols:"12",md:"3"},{default:l(()=>[t(g,{modelValue:a.amount,"onUpdate:modelValue":k=>a.amount=k,label:"Amount",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{cols:"12",md:"3"},{default:l(()=>[t(g,{modelValue:a.unit,"onUpdate:modelValue":k=>a.unit=k,label:"Unit",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(r,{cols:"12",md:"2",class:"d-flex align-center"},{default:l(()=>[t(c,{icon:"mdi-delete",color:"error",variant:"text",onClick:k=>G(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128)),t(c,{color:"primary",variant:"text",onClick:z,class:"mt-2"},{default:l(()=>e[15]||(e[15]=[y(" Add Ingredient ")])),_:1,__:[15]})]),_:1,__:[16]}),t(r,{cols:"12"},{default:l(()=>[t(T,{modelValue:n.value.instructions,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.instructions=a),label:"Instructions",required:"",hint:"Enter each step on a new line","persistent-hint":""},null,8,["modelValue"])]),_:1}),t(r,{cols:"12"},{default:l(()=>[e[17]||(e[17]=s("h4",{class:"text-h6 mb-4"},"Nutrition Information",-1)),t(C,null,{default:l(()=>[(o(!0),_(V,null,U(n.value.nutrition.per_serving,(a,m)=>(o(),p(r,{key:m,cols:"6",md:"3"},{default:l(()=>[t(g,{modelValue:n.value.nutrition.per_serving[m],"onUpdate:modelValue":k=>n.value.nutrition.per_serving[m]=k,modelModifiers:{number:!0},label:A(m),type:"number",required:""},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024))),128))]),_:1})]),_:1,__:[17]})]),_:1})]),_:1})):(o(),_(V,{key:0},[t(C,null,{default:l(()=>[t(r,{cols:"12",md:"6"},{default:l(()=>[e[12]||(e[12]=s("h4",{class:"text-h6 mb-4"},"Ingredients",-1)),t(le,null,{default:l(()=>[(o(!0),_(V,null,U(v.value.ingredients,a=>(o(),p(te,{key:a.name},{default:l(()=>[y(i(a.amount)+" "+i(a.unit)+" "+i(a.name),1)]),_:2},1024))),128))]),_:1})]),_:1,__:[12]}),t(r,{cols:"12",md:"6"},{default:l(()=>[e[13]||(e[13]=s("h4",{class:"text-h6 mb-4"},"Instructions",-1)),s("ol",Oe,[(o(!0),_(V,null,U(v.value.instructions.split(`
`),(a,m)=>(o(),_("li",{key:m,class:"mb-2"},i(a),1))),128))])]),_:1,__:[13]})]),_:1}),t(ae,{class:"my-4"}),e[14]||(e[14]=s("h4",{class:"text-h6 mb-4"},"Nutrition Information",-1)),t(C,null,{default:l(()=>[(o(!0),_(V,null,U(v.value.nutrition.per_serving,(a,m)=>(o(),p(r,{key:m,cols:"6",md:"3"},{default:l(()=>[t(N,{variant:"outlined"},{default:l(()=>[t(w,null,{default:l(()=>[s("div",We,i(A(m)),1),s("div",Ie,i(a),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))]),_:1}),t(de,null,{default:l(()=>[t(ue),x.value?(o(),_(V,{key:0},[t(c,{color:"error",variant:"text",onClick:Z},{default:l(()=>e[18]||(e[18]=[y(" Cancel ")])),_:1,__:[18]}),t(c,{color:"primary",onClick:j},{default:l(()=>e[19]||(e[19]=[y(" Save Changes ")])),_:1,__:[19]})],64)):(o(),p(c,{key:1,color:"primary",onClick:L},{default:l(()=>e[20]||(e[20]=[y(" Close ")])),_:1,__:[20]}))]),_:1})]),_:1})):$("",!0)]),_:1},8,["modelValue"])])}}};export{$e as default};
